# Configuration script for use with continuous integration service travis-ci.org

language: cpp

dist: bionic
 
matrix:
  include:
    # Sonar build
    - os: linux
      compiler: gcc
      addons: &gcc6
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-6']
        sonarcloud:
          organization: "rpreen"
      env: BUILD_TYPE="Debug" XCSF_PYLIB="OFF" SONAR="ON"
 
    # Python library Ubuntu 18.04
    - os: linux
      compiler: gcc
      addons: &gcc6
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-6', 'python3', 'libboost-python-dev', 'libboost-numpy-dev']
        sonarcloud:
          organization: "rpreen"
      env: BADGE=linux BUILD_TYPE="Release" XCSF_PYLIB="ON"

    # Python library OSX
    - os: osx
      osx_image: xcode10.1
      compiler: clang
      env: BADGE=osx BUILD_TYPE="Release" XCSF_PYLIB="ON"

before_script:
  - if [[ "${TRAVIS_OS_NAME}" != "linux" ]]; then
      brew install llvm
      brew install libomp
      brew install cmake || brew upgrade cmake
      if [[ "${XCSF_PYLIB}" == "ON" ]]; then
        brew install python || brew upgrade python
        brew install boost-python3
      fi
    fi

script:
  - cd "${TRAVIS_BUILD_DIR}/build"
    cmake -DCMAKE_BUILD_TYPE="$BUILD_TYPE" -DXCSF_PYLIB="$XCSF_PYLIB" ..
  - make
  - if [[ "${SONAR}" == "ON" ]]; then
      build-wrapper-linux-x86-64 --out-dir bw-output
      sonar-scanner
    fi
